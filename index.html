<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karacabay Emlak StÃ¼dyosu v5.0 (Pro EditÃ¶r)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f5; padding: 0; margin: 0; color: #333; height: 100vh; overflow: hidden; }
        .main-wrapper { display: grid; grid-template-columns: 400px 1fr; height: 100vh; }
        
        /* SOL PANEL */
        .controls { background: white; padding: 20px; border-right: 1px solid #ddd; overflow-y: auto; height: 100%; box-sizing: border-box; }
        
        h2 { border-bottom: 2px solid #e67e22; padding-bottom: 10px; color: #2c3e50; font-size: 18px; margin-top: 0; }
        .section-title { font-size: 12px; font-weight: 800; color: #95a5a6; text-transform: uppercase; margin: 20px 0 10px 0; letter-spacing: 1px; }

        /* Dosya YÃ¼kleme */
        .file-group { margin-bottom: 8px; background: #f8f9fa; padding: 8px; border-radius: 6px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: space-between; }
        input[type="file"] { font-size: 11px; width: 200px; }

        /* YENÄ° METÄ°N EKLEME ALANI */
        .text-creator { background: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #f1c40f; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        input[type="text"], select, input[type="number"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 13px; }
        .color-input { width: 100%; height: 35px; border: none; padding: 0; cursor: pointer; }
        
        .btn-add { background: #f39c12; color: white; border: none; padding: 10px; width: 100%; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add:hover { background: #d35400; }

        /* EKLENEN KATMANLAR */
        #layer-list { margin-top: 15px; }
        .layer-item { background: #fff; border: 1px solid #e0e0e0; padding: 10px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid #3498db; }
        .layer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 11px; }
        
        .layer-controls label { font-size: 10px; color: #7f8c8d; display: block; margin-top: 5px; }
        input[type="range"] { width: 100%; cursor: pointer; }

        /* Ä°ndirme Butonu */
        .btn-download { background: #27ae60; color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 30px; margin-bottom: 50px; }

        /* SAÄž PANEL: Ã–NÄ°ZLEME */
        .preview-area { background: #34495e; display: flex; align-items: center; justify-content: center; padding: 20px; overflow: hidden; }
        canvas { box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-width: 100%; max-height: 90vh; object-fit: contain; background: white; }

        @media (max-width: 900px) { .main-wrapper { grid-template-columns: 1fr; overflow-y: auto; } }
    </style>
</head>
<body>

<div class="main-wrapper">
    
    <div class="controls">
        <h2>âœ¨ Emlak StÃ¼dyosu v5.0</h2>

        <div class="section-title">1. Ana GÃ¶rseller</div>
        <div class="file-group" style="background: #eaf6ff; border-color: #3498db;">
            <label style="font-size:12px; font-weight:bold;">ANA RESÄ°M:</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'main')">
        </div>
        <div class="file-group"><label>Detay 1:</label><input type="file" accept="image/*" onchange="handleImage(this, 'sub1')"></div>
        <div class="file-group"><label>Detay 2:</label><input type="file" accept="image/*" onchange="handleImage(this, 'sub2')"></div>
        <div class="file-group"><label>Detay 3:</label><input type="file" accept="image/*" onchange="handleImage(this, 'sub3')"></div>
        <div class="file-group"><label>Detay 4:</label><input type="file" accept="image/*" onchange="handleImage(this, 'sub4')"></div>

        <div class="section-title">2. Metin EditÃ¶rÃ¼ (SÄ±nÄ±rsÄ±z)</div>
        <div class="text-creator">
            <input type="text" id="newText" placeholder="Metni buraya yazÄ±n (Ã–rn: SATILIK)">
            
            <div class="input-row" style="margin-top:10px;">
                <select id="newFont">
                    <option value="Arial">Arial (Standart)</option>
                    <option value="Impact">Impact (KalÄ±n)</option>
                    <option value="Georgia">Georgia (Serif)</option>
                    <option value="Verdana">Verdana (Modern)</option>
                    <option value="Courier New">Courier (Daktilo)</option>
                </select>
                <input type="number" id="newSize" value="60" placeholder="Boyut">
            </div>
            
            <div class="input-row">
                <input type="color" id="newColor" class="color-input" value="#ffffff" title="YazÄ± Rengi">
                <button class="btn-add" onclick="addTextLayer()">âž• Metni Ekle</button>
            </div>
        </div>

        <div id="layer-list">
            </div>

        <div class="section-title">3. Logo</div>
        <div class="file-group">
            <input type="file" accept="image/*" onchange="handleImage(this, 'logo')">
        </div>

        <button class="btn-download" onclick="downloadCanvas()">ðŸ’¾ GÃ¶rseli Ä°ndir (JPG)</button>
    </div>

    <div class="preview-area">
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Durum YÃ¶netimi
    const state = {
        images: { main: null, sub1: null, sub2: null, sub3: null, sub4: null, logo: null },
        texts: [] // Eklenen metinleri tutacak dizi
    };

    // Ä°lk YÃ¼kleme
    window.onload = function() {
        canvas.width = 1080; canvas.height = 1080; // VarsayÄ±lan Kare
        draw();
    };

    // Resim YÃ¼kleme
    function handleImage(input, key) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() { state.images[key] = img; draw(); };
                img.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // YENÄ°: Metin Ekleme Fonksiyonu
    function addTextLayer() {
        const content = document.getElementById('newText').value;
        const font = document.getElementById('newFont').value;
        const size = document.getElementById('newSize').value;
        const color = document.getElementById('newColor').value;

        if (!content) { alert("LÃ¼tfen bir metin yazÄ±n!"); return; }

        // Yeni metin objesi oluÅŸtur
        const newLayer = {
            id: Date.now(), // Benzersiz ID
            text: content,
            font: font,
            size: parseInt(size),
            color: color,
            x: 50, // VarsayÄ±lan Konum % (Orta)
            y: 50  // VarsayÄ±lan Konum % (Orta)
        };

        state.texts.push(newLayer);
        renderLayerControls(); // Sol panele kontrol ekle
        draw(); // Canvas'Ä± yenile
        
        // GiriÅŸ kutusunu temizle
        document.getElementById('newText').value = "";
    }

    // Katman Kontrollerini OluÅŸtur (Sol Panel)
    function renderLayerControls() {
        const list = document.getElementById('layer-list');
        list.innerHTML = ""; // Temizle ve baÅŸtan yap

        state.texts.forEach((layer, index) => {
            const item = document.createElement('div');
            item.className = 'layer-item';
            item.innerHTML = `
                <div class="layer-header">
                    <span style="color:${layer.color}">${layer.text}</span>
                    <button class="btn-delete" onclick="deleteLayer(${index})">Sil</button>
                </div>
                <div class="layer-controls">
                    <label>Yatay Konum</label>
                    <input type="range" min="0" max="100" value="${layer.x}" oninput="updateLayer(${index}, 'x', this.value)">
                    <label>Dikey Konum</label>
                    <input type="range" min="0" max="100" value="${layer.y}" oninput="updateLayer(${index}, 'y', this.value)">
                </div>
            `;
            list.appendChild(item);
        });
    }

    // Katman GÃ¼ncelleme
    function updateLayer(index, prop, value) {
        state.texts[index][prop] = parseInt(value);
        draw();
    }

    // Katman Silme
    function deleteLayer(index) {
        state.texts.splice(index, 1);
        renderLayerControls();
        draw();
    }

    // Ã‡izim Motoru
    function draw() {
        // 1. Arkaplan
        ctx.fillStyle = "#ecf0f1";
        ctx.fillRect(0,0, canvas.width, canvas.height);

        // 2. Ana Resim
        if (state.images.main) {
            drawImageProp(ctx, state.images.main, 0, 0, canvas.width, canvas.height);
        } else {
            ctx.fillStyle = "#bdc3c7"; ctx.font = "40px Arial"; ctx.textAlign = "center";
            ctx.fillText("Ana Resim YÃ¼kleyin", canvas.width/2, canvas.height/2);
        }

        // 3. Alt Resimler (Åžerit)
        const activeSubs = [state.images.sub1, state.images.sub2, state.images.sub3, state.images.sub4].filter(i => i);
        if (activeSubs.length > 0) {
            const stripH = canvas.height * 0.25;
            const startY = canvas.height - stripH - 20;
            
            // Åžerit ArkaplanÄ±
            ctx.fillStyle = "rgba(0,0,0,0.6)";
            ctx.fillRect(0, startY - 20, canvas.width, stripH + 40);
            
            const gap = 20;
            const cellW = (canvas.width - ((activeSubs.length+1)*gap)) / activeSubs.length;
            
            activeSubs.forEach((img, i) => {
                const x = gap + (i * (cellW + gap));
                drawImageProp(ctx, img, x, startY, cellW, stripH);
                // Ã‡erÃ§eve
                ctx.strokeStyle = "#fff"; ctx.lineWidth = 4;
                ctx.strokeRect(x, startY, cellW, stripH);
            });
        }

        // 4. Logo
        if (state.images.logo) {
            const logoW = canvas.width * 0.2;
            const logoH = logoW * (state.images.logo.height / state.images.logo.width);
            ctx.drawImage(state.images.logo, canvas.width - logoW - 20, 20, logoW, logoH);
        }

        // 5. METÄ°N KATMANLARI (Loop)
        state.texts.forEach(t => {
            const x = canvas.width * (t.x / 100);
            const y = canvas.height * (t.y / 100);

            ctx.save();
            ctx.font = `bold ${t.size}px ${t.font}`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";

            // GÃ¶lge Efekti (Okunurluk iÃ§in)
            ctx.shadowColor = "rgba(0,0,0,0.8)";
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;

            // YazÄ±yÄ± Ã‡iz
            ctx.fillStyle = t.color;
            ctx.fillText(t.text, x, y);

            // Opsiyonel: KontÃ¼r (Stroke)
            ctx.shadowBlur = 0; // KontÃ¼rde gÃ¶lge istemiyoruz
            ctx.lineWidth = 2;
            ctx.strokeStyle = "rgba(0,0,0,0.3)";
            ctx.strokeText(t.text, x, y);

            ctx.restore();
        });
    }

    // YardÄ±mcÄ± Fonksiyon: Resmi OrantÄ±lÄ± SÄ±ÄŸdÄ±r
    function drawImageProp(ctx, img, x, y, w, h) {
        const offsetX = 0.5, offsetY = 0.5;
        const iw = img.width, ih = img.height;
        const r = Math.min(w / iw, h / ih);
        let nw = iw * r, nh = ih * r;
        let cx, cy, cw, ch, ar = 1;
        if (nw < w) ar = w / nw;
        if (Math.abs(ar - 1) < 1e-14 && nh < h) ar = h / nh;
        nw *= ar; nh *= ar;
        cw = iw / (nw / w); ch = ih / (nh / h);
        cx = (iw - cw) * offsetX; cy = (ih - ch) * offsetY;
        if (cx < 0) cx = 0; if (cy < 0) cy = 0;
        if (cw > iw) cw = iw; if (ch > ih) ch = ih;
        ctx.drawImage(img, cx, cy, cw, ch, x, y, w, h);
    }

    function downloadCanvas() {
        const link = document.createElement('a');
        link.download = 'karacabay-emlak-post.jpg';
        link.href = canvas.toDataURL('image/jpeg', 0.9);
        link.click();
    }
</script>

</body>
</html>
