<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karacabay Emlak StÃ¼dyosu V9 (Ultra)</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700;900&family=Playfair+Display:wght@700&family=Poppins:wght@400;600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f5; margin: 0; height: 100vh; overflow: hidden; color: #333; }
        .wrapper { display: grid; grid-template-columns: 360px 1fr; height: 100vh; }
        
        /* SOL PANEL */
        .sidebar { background: white; padding: 15px; border-right: 1px solid #ddd; overflow-y: auto; height: 100%; position: relative; }
        
        h2 { border-bottom: 2px solid #e67e22; padding-bottom: 10px; color: #2c3e50; font-size: 16px; margin-top: 0; }
        .group-title { font-size: 10px; font-weight: 800; color: #7f8c8d; text-transform: uppercase; margin: 12px 0 5px 0; border-bottom: 1px solid #eee; padding-bottom: 2px; }

        /* Butonlar */
        .btn-group { display: flex; gap: 5px; margin-bottom: 5px; }
        .btn-toggle { flex: 1; padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer; border-radius: 4px; font-size: 11px; font-weight: bold; text-align: center; transition: 0.2s; }
        .btn-toggle.active { background: #3498db; color: white; border-color: #3498db; }
        .btn-toggle.disabled { opacity: 0.5; pointer-events: none; }

        /* GÃ–RSEL SEÃ‡Ä°M LÄ°STESÄ° (YENÄ° SÄ°STEM) */
        .img-selector-list { display: flex; flex-direction: column; gap: 4px; }
        .img-item { display: flex; align-items: center; justify-content: space-between; padding: 6px; border: 1px solid #eee; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .img-item:hover { background: #f9f9f9; }
        .img-item.active { border-color: #3498db; background: #eaf6ff; border-left: 4px solid #3498db; }
        .img-item label { font-size: 11px; font-weight: bold; cursor: pointer; flex: 1; }
        .img-item input { width: 170px; font-size: 9px; }

        /* TEK MERKEZLÄ° KUMANDA (MASTER CONTROL) */
        .master-controls { background: #2c3e50; color: white; padding: 10px; border-radius: 6px; margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .master-header { font-size: 10px; font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .control-row { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .control-row span { font-size: 12px; width: 15px; }
        .control-row input { flex: 1; cursor: pointer; }

        /* METÄ°N VE EMOJI */
        .text-box { background: #fff8e1; padding: 10px; border: 1px solid #f1c40f; border-radius: 6px; }
        .input-text { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; margin-bottom: 5px; font-size: 13px; font-family: inherit; }
        .btn-emoji-open { width: 100%; background: #fff; border: 1px dashed #ccc; padding: 5px; margin-bottom: 5px; cursor: pointer; font-size: 11px; border-radius: 4px; }
        .btn-emoji-open:hover { background: #fafafa; border-color: #aaa; }
        
        .btn-action { width: 100%; background: #f39c12; color: white; border: none; padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-action.update { background: #27ae60; }

        /* EMOJI POPUP (MODAL) */
        .emoji-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 999; border: 1px solid #ddd; }
        .emoji-header { background: #f8f9fa; padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 12px; border-radius: 8px 8px 0 0; }
        .emoji-body { padding: 10px; max-height: 300px; overflow-y: auto; }
        .emoji-category { font-size: 10px; color: #888; margin-top: 8px; margin-bottom: 4px; font-weight: bold; border-bottom: 1px solid #eee; }
        .emoji-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; }
        .emoji-btn { font-size: 18px; cursor: pointer; background: none; border: 1px solid transparent; padding: 4px; border-radius: 4px; }
        .emoji-btn:hover { background: #eee; border-color: #ddd; }
        .close-modal { cursor: pointer; font-size: 14px; color: #e74c3c; }

        /* KATMAN LÄ°STESÄ° */
        .layer-list { margin-top: 5px; border: 1px solid #eee; background: #fafafa; max-height: 120px; overflow-y: auto; border-radius: 4px; }
        .layer-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 8px; border-bottom: 1px solid #eee; font-size: 11px; cursor: pointer; }
        .layer-row.selected { background: #d5eafc; border-left: 3px solid #3498db; }
        
        /* FOOTER */
        .footer-settings { background: #34495e; color: white; padding: 10px; border-radius: 6px; font-size: 11px; }
        .footer-input { width: 100%; padding: 4px; margin-top: 4px; border: none; border-radius: 3px; box-sizing: border-box; }

        .btn-download { background: #27ae60; color: white; width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 14px; }

        /* SAÄ PANEL */
        .canvas-area { background: #5f6c7b; display: flex; align-items: center; justify-content: center; padding: 20px; }
        canvas { box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-width: 100%; max-height: 95vh; object-fit: contain; background: white; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="sidebar">
        <h2>ğŸš€ Emlak StÃ¼dyosu V9</h2>

        <div class="group-title">1. Format & DÃ¼zen</div>
        <div class="btn-group">
            <div class="btn-toggle active" id="btn-post" onclick="setFormat('post')">Kare (Post)</div>
            <div class="btn-toggle" id="btn-story" onclick="setFormat('story')">Hikaye (Story)</div>
        </div>
        <div class="btn-group">
            <div class="btn-toggle active" id="btn-btm" onclick="setLayout('bottom')">Alt Åerit</div>
            <div class="btn-toggle" id="btn-side" onclick="setLayout('side')">Yan Åerit</div>
        </div>

        <div class="group-title">2. GÃ¶rselleri SeÃ§ & YÃ¼kle</div>
        <div class="img-selector-list">
            <div class="img-item active" onclick="selectActiveImg('main')" id="item-main">
                <label>â­ Ana Vitrin</label>
                <input type="file" accept="image/*" onchange="loadImg(this, 'main')">
            </div>
            <div class="img-item" onclick="selectActiveImg('sub1')" id="item-sub1">
                <label>1. Detay</label>
                <input type="file" accept="image/*" onchange="loadImg(this, 'sub1')">
            </div>
            <div class="img-item" onclick="selectActiveImg('sub2')" id="item-sub2">
                <label>2. Detay</label>
                <input type="file" accept="image/*" onchange="loadImg(this, 'sub2')">
            </div>
            <div class="img-item" onclick="selectActiveImg('sub3')" id="item-sub3">
                <label>3. Detay</label>
                <input type="file" accept="image/*" onchange="loadImg(this, 'sub3')">
            </div>
            <div class="img-item" onclick="selectActiveImg('sub4')" id="item-sub4">
                <label>4. Detay</label>
                <input type="file" accept="image/*" onchange="loadImg(this, 'sub4')">
            </div>
        </div>

        <div class="master-controls">
            <div class="master-header">
                <span id="activeImgLabel">SeÃ§ili Resim: ANA VÄ°TRÄ°N</span>
                <span>Kadraj AyarÄ±</span>
            </div>
            <div class="control-row">
                <span>â†”</span>
                <input type="range" id="masterX" min="0" max="100" value="50" oninput="updateMasterPos('x', this.value)">
            </div>
            <div class="control-row">
                <span>â†•</span>
                <input type="range" id="masterY" min="0" max="100" value="50" oninput="updateMasterPos('y', this.value)">
            </div>
        </div>

        <div class="group-title">3. Metin & Emoji</div>
        <div class="text-box">
            <button class="btn-emoji-open" onclick="toggleEmojiModal()">ğŸ˜Š Emojileri GÃ¶ster / Gizle</button>
            <input type="text" id="tTxt" class="input-text" placeholder="Metin yazÄ±n...">
            
            <div style="display:flex; gap:5px; margin-bottom:5px;">
                <select id="tFont" style="flex:1; font-size:11px;">
                    <option value="Arial">Arial (Standart)</option>
                    <option value="'Montserrat', sans-serif">Montserrat (Modern)</option>
                    <option value="'Poppins', sans-serif">Poppins (Yuvarlak)</option>
                    <option value="'Playfair Display', serif">Playfair (LÃ¼ks/Serif)</option>
                    <option value="'Bebas Neue', sans-serif">Bebas (Uzun/BaÅŸlÄ±k)</option>
                    <option value="'Roboto', sans-serif">Roboto (Teknik)</option>
                </select>
                <input type="number" id="tSize" value="60" style="width:40px">
                <input type="color" id="tColor" value="#ffffff" style="width:30px; border:none;">
            </div>

            <button id="btnAction" class="btn-action" onclick="handleTextAction()">â• EKLE</button>
            <button id="btnCancel" onclick="cancelEdit()" style="display:none; width:100%; margin-top:5px; font-size:10px; cursor:pointer;">Ä°ptal</button>
        </div>

        <div id="layerList" class="layer-list"></div>
        
        <div id="textPosControls" style="display:none; margin-top:5px; padding:5px; background:#fff8e1; border:1px solid #f1c40f; border-radius:4px;">
            <label style="font-size:10px; font-weight:bold;">SeÃ§ili Metni KaydÄ±r:</label>
            <div class="control-row" style="margin-bottom:0;">
                <input type="range" id="txtX" min="0" max="100" oninput="moveSelected('x', this.value)">
                <input type="range" id="txtY" min="0" max="100" oninput="moveSelected('y', this.value)">
            </div>
        </div>

        <div class="group-title">4. Footer</div>
        <div class="footer-settings">
            <label><input type="checkbox" id="showFooter" onchange="draw()"> Alt Åerit AÃ§</label>
            <input type="text" id="footerTel" class="footer-input" placeholder="Tel: 05XX..." oninput="draw()">
            <input type="text" id="footerWeb" class="footer-input" placeholder="Web:..." oninput="draw()">
            <input type="color" id="footerColor" value="#000000" style="width:100%; height:20px; margin-top:5px; border:none;" oninput="draw()">
        </div>

        <div class="group-title">5. Logo</div>
        <div class="img-item" onclick="selectActiveImg('logo')" id="item-logo">
            <label>Logo DosyasÄ±</label>
            <input type="file" accept="image/*" onchange="loadImg(this, 'logo')">
        </div>

        <button class="btn-download" onclick="download()">ğŸ’¾ Ä°NDÄ°R</button>
        <div style="height:50px"></div>
    </div>

    <div class="canvas-area">
        <canvas id="canvas"></canvas>
    </div>
</div>

<div class="emoji-modal" id="emojiModal">
    <div class="emoji-header">
        <span>Emoji KÃ¼tÃ¼phanesi</span>
        <span class="close-modal" onclick="toggleEmojiModal()">âœ–</span>
    </div>
    <div class="emoji-body">
        <div class="emoji-category">EMLAK & YAPI</div>
        <div class="emoji-grid">
            <button class="emoji-btn" onclick="ins('ğŸ ')">ğŸ </button>
            <button class="emoji-btn" onclick="ins('ğŸ¡')">ğŸ¡</button>
            <button class="emoji-btn" onclick="ins('ğŸ¢')">ğŸ¢</button>
            <button class="emoji-btn" onclick="ins('ğŸ—ï¸')">ğŸ—ï¸</button>
            <button class="emoji-btn" onclick="ins('ğŸ”‘')">ğŸ”‘</button>
            <button class="emoji-btn" onclick="ins('ğŸšª')">ğŸšª</button>
        </div>
        
        <div class="emoji-category">Ã–ZELLÄ°KLER & LÃœKS</div>
        <div class="emoji-grid">
            <button class="emoji-btn" onclick="ins('ğŸŠ')">ğŸŠ</button>
            <button class="emoji-btn" onclick="ins('ğŸŒ´')">ğŸŒ´</button>
            <button class="emoji-btn" onclick="ins('â˜€ï¸')">â˜€ï¸</button>
            <button class="emoji-btn" onclick="ins('ğŸŒŠ')">ğŸŒŠ</button>
            <button class="emoji-btn" onclick="ins('ğŸ”¥')">ğŸ”¥</button>
            <button class="emoji-btn" onclick="ins('ğŸ’')">ğŸ’</button>
            <button class="emoji-btn" onclick="ins('ğŸš—')">ğŸš—</button>
            <button class="emoji-btn" onclick="ins('ğŸ›¡ï¸')">ğŸ›¡ï¸</button>
        </div>

        <div class="emoji-category">Ä°LETÄ°ÅÄ°M & DÄ°KKAT</div>
        <div class="emoji-grid">
            <button class="emoji-btn" onclick="ins('ğŸ“')">ğŸ“</button>
            <button class="emoji-btn" onclick="ins('ğŸ“±')">ğŸ“±</button>
            <button class="emoji-btn" onclick="ins('ğŸ“')">ğŸ“</button>
            <button class="emoji-btn" onclick="ins('ğŸ“£')">ğŸ“£</button>
            <button class="emoji-btn" onclick="ins('ğŸš€')">ğŸš€</button>
            <button class="emoji-btn" onclick="ins('âœ¨')">âœ¨</button>
            <button class="emoji-btn" onclick="ins('âœ…')">âœ…</button>
            <button class="emoji-btn" onclick="ins('ğŸ”´')">ğŸ”´</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // STATE
    const state = {
        format: 'post', layout: 'bottom',
        activeImgKey: 'main', // Åu an hangi resim kumanda ediliyor?
        imgs: { 
            main: {obj:null, x:50, y:50}, 
            sub1: {obj:null, x:50, y:50}, sub2: {obj:null, x:50, y:50}, 
            sub3: {obj:null, x:50, y:50}, sub4: {obj:null, x:50, y:50}, 
            logo: {obj:null, x:90, y:5, size:20} // Logo iÃ§in Ã¶zel yapÄ±
        },
        texts: [],
        editingId: null
    };

    window.onload = () => { draw(); };

    // 1. FORMAT & LAYOUT
    function setFormat(f) {
        state.format = f;
        document.querySelectorAll('#btn-post, #btn-story').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + f).classList.add('active');
        
        const sideBtn = document.getElementById('btn-side');
        if(f === 'story') { setLayout('bottom'); sideBtn.classList.add('disabled'); }
        else { sideBtn.classList.remove('disabled'); }
        draw();
    }
    function setLayout(l) {
        state.layout = l;
        document.querySelectorAll('#btn-btm, #btn-side').forEach(b => b.classList.remove('active'));
        document.getElementById(l==='bottom'?'btn-btm':'btn-side').classList.add('active');
        draw();
    }

    // 2. RESÄ°M SEÃ‡Ä°MÄ° VE YÃœKLEME
    function selectActiveImg(key) {
        state.activeImgKey = key;
        
        // UI GÃ¼ncelle (Hangi satÄ±r seÃ§ili?)
        document.querySelectorAll('.img-item').forEach(el => el.classList.remove('active'));
        document.getElementById('item-' + key).classList.add('active');

        // Master Kumanda BaÅŸlÄ±ÄŸÄ±nÄ± GÃ¼ncelle
        let label = "Bilinmiyor";
        if(key === 'main') label = "ANA VÄ°TRÄ°N";
        else if(key === 'logo') label = "LOGO";
        else label = key.toUpperCase().replace('SUB', 'DETAY ');
        document.getElementById('activeImgLabel').innerText = "SeÃ§ili Resim: " + label;

        // SliderlarÄ± o resmin mevcut konumuna getir
        if(key === 'logo') {
            document.getElementById('masterX').value = state.imgs.logo.x;
            document.getElementById('masterY').value = state.imgs.logo.y;
        } else {
            document.getElementById('masterX').value = state.imgs[key].x;
            document.getElementById('masterY').value = state.imgs[key].y;
        }
    }

    function loadImg(input, key) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const i = new Image();
                i.onload = () => {
                    state.imgs[key].obj = i;
                    // YÃ¼klenen resmi otomatik seÃ§
                    selectActiveImg(key);
                    draw();
                };
                i.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // MASTER SLIDER (TEK KUMANDA)
    function updateMasterPos(axis, val) {
        const key = state.activeImgKey;
        state.imgs[key][axis] = val;
        draw();
    }

    // 3. EMOJI & METÄ°N
    function toggleEmojiModal() {
        const el = document.getElementById('emojiModal');
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }
    function ins(char) {
        document.getElementById('tTxt').value += char + " ";
        toggleEmojiModal(); // SeÃ§ince kapat
    }

    function handleTextAction() {
        const val = document.getElementById('tTxt').value;
        if(!val) return;
        const font = document.getElementById('tFont').value;
        const size = document.getElementById('tSize').value;
        const color = document.getElementById('tColor').value;

        if(state.editingId !== null) {
            const txt = state.texts.find(t => t.id === state.editingId);
            if(txt) { txt.text=val; txt.font=font; txt.size=size; txt.color=color; }
            cancelEdit();
        } else {
            const newId = Date.now();
            state.texts.push({id:newId, text:val, font:font, size:size, color:color, x:50, y:50});
            loadTextToEdit(newId);
        }
        draw(); renderLayerList();
    }

    function loadTextToEdit(id) {
        const txt = state.texts.find(t => t.id === id);
        if(!txt) return;
        state.editingId = id;
        document.getElementById('tTxt').value = txt.text;
        document.getElementById('tFont').value = txt.font; // Fontu seÃ§
        document.getElementById('tSize').value = txt.size;
        document.getElementById('tColor').value = txt.color;
        document.getElementById('btnAction').innerText = "GÃœNCELLE â†»";
        document.getElementById('btnAction').classList.add('update');
        document.getElementById('btnCancel').style.display = 'block';
        
        document.getElementById('textPosControls').style.display = 'block';
        document.getElementById('txtX').value = txt.x;
        document.getElementById('txtY').value = txt.y;
        
        renderLayerList(); draw();
    }

    function cancelEdit() {
        state.editingId = null;
        document.getElementById('tTxt').value = "";
        document.getElementById('btnAction').innerText = "â• EKLE";
        document.getElementById('btnAction').classList.remove('update');
        document.getElementById('btnCancel').style.display = 'none';
        document.getElementById('textPosControls').style.display = 'none';
        renderLayerList(); draw();
    }

    function moveSelected(axis, val) {
        if(state.editingId !== null) {
            const txt = state.texts.find(t => t.id === state.editingId);
            if(txt) { txt[axis] = val; draw(); }
        }
    }

    function renderLayerList() {
        const el = document.getElementById('layerList');
        el.innerHTML = '';
        state.texts.forEach(t => {
            const isSel = t.id === state.editingId;
            const div = document.createElement('div');
            div.className = `layer-row ${isSel?'selected':''}`;
            div.innerHTML = `<span onclick="loadTextToEdit(${t.id})" style="flex:1">${t.text}</span> <button class="del-btn" onclick="delTx(${t.id})">âœ–</button>`;
            el.appendChild(div);
        });
    }
    function delTx(id) {
        state.texts = state.texts.filter(t => t.id !== id);
        if(state.editingId === id) cancelEdit();
        renderLayerList(); draw();
    }

    // --- Ã‡Ä°ZÄ°M MOTORU ---
    function draw() {
        canvas.width = 1080; canvas.height = state.format==='post'?1080:1920;
        ctx.fillStyle="#ecf0f1"; ctx.fillRect(0,0,canvas.width,canvas.height);

        // 1. Ana Resim
        if(state.imgs.main.obj) drawCropped(ctx, state.imgs.main, 0,0, canvas.width, canvas.height);
        else { ctx.fillStyle="#bdc3c7"; ctx.font="40px sans-serif"; ctx.textAlign="center"; ctx.fillText("Ana Resim Bekleniyor...", canvas.width/2, canvas.height/2); }

        // 2. Alt Resimler
        const subs = [state.imgs.sub1, state.imgs.sub2, state.imgs.sub3, state.imgs.sub4].filter(i=>i.obj);
        const hasFooter = document.getElementById('showFooter').checked;
        const fH = state.format==='story'?120:100;
        const fOff = hasFooter?fH:0;

        if(subs.length > 0) {
            if(state.format === 'story') {
                const sH = canvas.height*0.3;
                const sY = canvas.height - sH - 50 - fOff;
                ctx.fillStyle="rgba(0,0,0,0.7)"; ctx.fillRect(0, sY, canvas.width, sH+200);
                const gap=20, cw=(canvas.width-gap*3)/2, ch=(sH-gap)/2;
                subs.forEach((img,i)=>{ if(i>3)return;
                    const col=i%2, row=Math.floor(i/2);
                    const x=gap+col*(cw+gap), y=sY+gap+row*(ch+gap);
                    ctx.fillStyle="#fff"; ctx.fillRect(x-5,y-5,cw+10,ch+10);
                    drawCropped(ctx, img, x,y,cw,ch);
                });
            } else if(state.layout === 'side') {
                const sw = canvas.width*0.28, sx = canvas.width-sw;
                ctx.fillStyle="rgba(255,255,255,0.95)"; ctx.fillRect(sx,0,sw,canvas.height);
                const ch = (canvas.height-(subs.length+1)*10 - fOff)/subs.length;
                subs.forEach((img,i)=>{
                    drawCropped(ctx, img, sx+10, 10+i*(ch+10), sw-20, ch);
                });
            } else {
                const sH = canvas.height*0.25, sY = canvas.height - sH - 20 - fOff;
                ctx.fillStyle="rgba(0,0,0,0.6)"; ctx.fillRect(0, sY-20, canvas.width, sH+40);
                const gap=20, cw=(canvas.width-(subs.length+1)*gap)/subs.length;
                subs.forEach((img,i)=>{
                    const x=gap+i*(cw+gap);
                    ctx.fillStyle="#fff"; ctx.fillRect(x-5,sY-5,cw+10,sH+10);
                    drawCropped(ctx, img, x,sY,cw,sH);
                });
            }
        }

        // 3. Logo (Logo iÃ§in boyut slider'Ä± olmadÄ±ÄŸÄ±ndan ÅŸimdilik sabit oranda ama konumu master'dan alÄ±r)
        if(state.imgs.logo.obj) {
            const img=state.imgs.logo.obj;
            // Logo boyutu iÃ§in hala Ã¶zel bir slider ekleyebiliriz ama ÅŸimdilik sabit %20
            const lw=canvas.width*0.2; 
            const lh=lw*(img.height/img.width);
            const lx=(canvas.width-lw)*(state.imgs.logo.x/100);
            const ly=(canvas.height-lh)*(state.imgs.logo.y/100);
            ctx.shadowColor="rgba(0,0,0,0.5)"; ctx.shadowBlur=10;
            ctx.drawImage(img, lx, ly, lw, lh);
            ctx.shadowBlur=0;
        }

        // 4. Footer
        if(hasFooter) {
            const fY = canvas.height - fH;
            ctx.fillStyle=document.getElementById('footerColor').value;
            ctx.fillRect(0, fY, canvas.width, fH);
            ctx.fillStyle="#fff"; ctx.textAlign="center"; ctx.textBaseline="middle";
            const tel=document.getElementById('footerTel').value;
            const web=document.getElementById('footerWeb').value;
            const bf=state.format==='story'?40:32;
            if(tel&&web) {
                ctx.font=`bold ${bf}px 'Montserrat'`; ctx.fillText(tel, canvas.width/2, fY+fH*0.35);
                ctx.font=`${bf-5}px 'Montserrat'`; ctx.fillText(web, canvas.width/2, fY+fH*0.75);
            } else {
                ctx.font=`bold ${bf}px 'Montserrat'`; ctx.fillText(tel||web, canvas.width/2, fY+fH/2);
            }
        }

        // 5. Metinler
        state.texts.forEach(t => {
            const x=canvas.width*(t.x/100), y=canvas.height*(t.y/100);
            ctx.save();
            ctx.font = `bold ${t.size}px ${t.font}`; // Font ailesi burada uygulanÄ±r
            ctx.textAlign="center"; ctx.textBaseline="middle";
            ctx.shadowColor="rgba(0,0,0,0.8)"; ctx.shadowBlur=8;
            ctx.fillStyle=t.color;
            ctx.fillText(t.text, x, y);
            if(t.id===state.editingId) {
                ctx.shadowBlur=0; ctx.strokeStyle="#e74c3c"; ctx.lineWidth=3; ctx.setLineDash([10,5]);
                const m=ctx.measureText(t.text);
                const h=parseInt(t.size);
                ctx.strokeRect(x-m.width/2-10, y-h/2-10, m.width+20, h+20);
            }
            ctx.restore();
        });
    }

    function drawCropped(ctx, imgData, x,y,w,h) {
        const img=imgData.obj;
        const rBox=w/h, rImg=img.width/img.height;
        let sw,sh,sx,sy;
        if(rImg>rBox) { sh=img.height; sw=sh*rBox; } else { sw=img.width; sh=sw/rBox; }
        sx=(img.width-sw)*(imgData.x/100); sy=(img.height-sh)*(imgData.y/100);
        ctx.drawImage(img, sx,sy,sw,sh, x,y,w,h);
    }
    function download() {
        const a=document.createElement('a'); a.download='karacabay-v9.jpg';
        a.href=canvas.toDataURL('image/jpeg',0.95); a.click();
    }
</script>

</body>
</html>
