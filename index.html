<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karacabay Emlak St√ºdyosu v3.0</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eaeff2; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        
        /* Sol Panel: Kontroller */
        .controls { background: white; padding: 20px; border-radius: 12px; height: fit-content; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { border-bottom: 2px solid #e67e22; padding-bottom: 10px; color: #2c3e50; font-size: 18px; margin-top: 0; }
        h3 { font-size: 14px; margin-top: 15px; margin-bottom: 8px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; }
        
        .file-group { margin-bottom: 12px; background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px dashed #ccc; }
        .file-group label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; }
        input[type="file"] { font-size: 12px; width: 100%; }
        
        .slider-group { margin-bottom: 10px; }
        .slider-group label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 3px; }
        input[type="range"] { width: 100%; }

        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        .btn-download { background: #27ae60; color: white; }
        .btn-download:hover { background: #219150; }
        .btn-prompt { background: #3498db; color: white; margin-bottom: 20px; }
        
        /* Saƒü Panel: √ñnizleme */
        .preview { background: #34495e; padding: 20px; border-radius: 12px; display: flex; align-items: center; justify-content: center; min-height: 600px; }
        canvas { box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 100%; max-height: 80vh; object-fit: contain; }

        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    
    <div class="controls">
        <h2>üõ†Ô∏è St√ºdyo Paneli</h2>

        <button class="btn btn-prompt" onclick="copyPrompt()">ü§ñ √ñnce Metni Hazƒ±rla (Kopyala)</button>

        <h3>1. Ana Sahne (B√ºy√ºk Fon)</h3>
        <div class="file-group" style="border-color: #3498db; background: #eaf6ff;">
            <label>Ana Fotoƒürafƒ± Se√ßin:</label>
            <input type="file" id="mainImg" accept="image/*" onchange="handleImage(this, 'main')">
        </div>

        <h3>2. Detay Pencereleri (Max 4)</h3>
        <div class="file-group">
            <label>K√º√ß√ºk Resim 1:</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'sub1')">
        </div>
        <div class="file-group">
            <label>K√º√ß√ºk Resim 2:</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'sub2')">
        </div>
        <div class="file-group">
            <label>K√º√ß√ºk Resim 3:</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'sub3')">
        </div>
        <div class="file-group">
            <label>K√º√ß√ºk Resim 4:</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'sub4')">
        </div>

        <h3>3. Markalama</h3>
        <div class="file-group" style="border-color: #e67e22; background: #fff5ea;">
            <label>Logonuzu Se√ßin (PNG):</label>
            <input type="file" accept="image/*" onchange="handleImage(this, 'logo')">
        </div>
        
        <div class="slider-group">
            <label>Logo Boyutu</label>
            <input type="range" min="5" max="50" value="20" oninput="settings.logoSize=this.value; draw();">
        </div>
        <div class="slider-group">
            <label>Logo Konumu (Yatay)</label>
            <input type="range" min="0" max="100" value="90" oninput="settings.logoX=this.value; draw();">
        </div>
        <div class="slider-group">
            <label>Logo Konumu (Dikey)</label>
            <input type="range" min="0" max="100" value="10" oninput="settings.logoY=this.value; draw();">
        </div>

        <button class="btn btn-download" onclick="downloadCanvas()">üíæ Tasarƒ±mƒ± ƒ∞ndir</button>
    </div>

    <div class="preview">
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // G√∂rselleri hafƒ±zada tutacaƒüƒ±mƒ±z obje
    const images = {
        main: null,
        sub1: null,
        sub2: null,
        sub3: null,
        sub4: null,
        logo: null
    };

    // Ayarlar
    const settings = {
        logoSize: 20, // Y√ºzde
        logoX: 90,
        logoY: 10,
        gap: 20 // K√º√ß√ºk resimler arasƒ± bo≈üluk (px)
    };

    // Dosya Y√ºkleme Fonksiyonu
    function handleImage(input, key) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    images[key] = img;
                    draw(); // Her resim y√ºklendiƒüinde yeniden √ßiz
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Ana √áizim Fonksiyonu (Logic Engine)
    function draw() {
        // Eƒüer ana resim yoksa √ßizme
        if (!images.main) {
            canvas.width = 800; canvas.height = 600;
            ctx.fillStyle = "#ecf0f1"; ctx.fillRect(0,0,800,600);
            ctx.fillStyle = "#7f8c8d"; ctx.font = "30px Arial"; ctx.textAlign = "center";
            ctx.fillText("L√ºtfen √∂nce ANA RESƒ∞M y√ºkleyin", 400, 300);
            return;
        }

        // 1. Canvas boyutunu ana resme g√∂re ayarla
        canvas.width = images.main.width;
        canvas.height = images.main.height;

        // 2. Ana Resmi √áiz
        ctx.drawImage(images.main, 0, 0);

        // 3. Alt Resimler (Varsa)
        // Hangi alt resimler dolu kontrol et
        const activeSubs = [images.sub1, images.sub2, images.sub3, images.sub4].filter(img => img !== null);
        
        if (activeSubs.length > 0) {
            // Alt ≈üerit y√ºksekliƒüi (Resmin %25'i kadar)
            const stripHeight = canvas.height * 0.25;
            const startY = canvas.height - stripHeight - (canvas.height * 0.02); // En alttan biraz bo≈üluk
            
            // Her bir k√º√ß√ºk resmin geni≈üliƒüi
            const totalGap = (activeSubs.length + 1) * settings.gap; // Toplam bo≈üluk payƒ±
            const singleWidth = (canvas.width - totalGap) / activeSubs.length;

            // Arka plana yarƒ± saydam siyah ≈üerit at (Okunurluk i√ßin)
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.fillRect(0, startY - 20, canvas.width, stripHeight + 40);

            // K√º√ß√ºk resimleri d√∂ng√ºyle √ßiz
            activeSubs.forEach((subImg, index) => {
                const x = settings.gap + (index * (singleWidth + settings.gap));
                const y = startY;
                
                // Beyaz √áer√ßeve
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(x - 5, y - 5, singleWidth + 10, stripHeight + 10);

                // Resmi Kƒ±rparak √áiz (Aspect Ratio Koru)
                drawImageProp(ctx, subImg, x, y, singleWidth, stripHeight);
            });
        }

        // 4. Logo √áizimi
        if (images.logo) {
            const logoW = (canvas.width * (settings.logoSize / 100));
            const logoH = logoW * (images.logo.height / images.logo.width);
            
            // Konum hesapla (merkez noktasƒ±na g√∂re deƒüil, sol √ºst k√∂≈üeye g√∂re)
            const posX = (canvas.width - logoW) * (settings.logoX / 100);
            const posY = (canvas.height - logoH) * (settings.logoY / 100);

            // G√∂lge ekle (Logo daha net g√∂r√ºns√ºn)
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowBlur = 10;
            ctx.drawImage(images.logo, posX, posY, logoW, logoH);
            ctx.shadowBlur = 0; // G√∂lgeyi sƒ±fƒ±rla
        }
    }

    // Resmi orantƒ±lƒ± sƒ±ƒüdƒ±rma (Cover mantƒ±ƒüƒ±)
    function drawImageProp(ctx, img, x, y, w, h) {
        // Varsayƒ±lan resim oranlarƒ±
        const offsetX = 0.5;
        const offsetY = 0.5;

        const iw = img.width, ih = img.height;
        const r = Math.min(w / iw, h / ih);
        let nw = iw * r, nh = ih * r;
        let cx, cy, cw, ch, ar = 1;

        // Resmi kutuya "cover" (dolduracak) ≈üekilde ayarla
        if (nw < w) ar = w / nw;
        if (Math.abs(ar - 1) < 1e-14 && nh < h) ar = h / nh;
        nw *= ar;
        nh *= ar;

        cw = iw / (nw / w);
        ch = ih / (nh / h);
        cx = (iw - cw) * offsetX;
        cy = (ih - ch) * offsetY;

        if (cx < 0) cx = 0;
        if (cy < 0) cy = 0;
        if (cw > iw) cw = iw;
        if (ch > ih) ch = ih;

        ctx.drawImage(img, cx, cy, cw, ch, x, y, w, h);
    }

    function downloadCanvas() {
        if (!images.main) { alert("L√ºtfen en az bir ana resim y√ºkleyin."); return; }
        const link = document.createElement('a');
        link.download = 'karacabay-emlak-kolaj.jpg';
        link.href = canvas.toDataURL('image/jpeg', 0.9); // Y√ºksek kalite JPG
        link.click();
    }

    function copyPrompt() {
        const text = "Gayrimenkul uzmanƒ± olarak davran. Elimde harika bir m√ºlk var. Bunun i√ßin 1 adet 'Ana Man≈üet' g√∂rseli ve 4 adet 'Detay' g√∂rselinden olu≈üan bir kolaj hazƒ±rladƒ±m. Buna uygun; 1. Dikkat √ßekici bir Instagram ba≈ülƒ±ƒüƒ±, 2. Her detay fotoƒürafƒ± i√ßin (Mutfak, Banyo, Manzara vb.) 1'er c√ºmlelik a√ßƒ±klama, 3. Eylem √ßaƒürƒ±sƒ± (DM/Ara) i√ßeren bir metin yaz.";
        navigator.clipboard.writeText(text).then(() => alert("Metin ≈üablonu kopyalandƒ±! ≈ûimdi Gemini'ye yapƒ±≈ütƒ±rabilirsin."));
    }
</script>

</body>
</html>
